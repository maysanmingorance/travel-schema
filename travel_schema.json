{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Trip Context Schema (aligned)",
  "type": "object",
  "properties": {
    "meta": {
      "type": "object",
      "properties": {
        "client_name": { "type": "string" },
        "destination": { "type": "string", "minLength": 1 },
        "start_date": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" },
        "end_date":   { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" },
        "date_range_human": { "type": "string" },
        "nights": { "type": "integer", "minimum": 0 },
        "travelers": {
          "type": "object",
          "properties": {
            "adults":   { "type": "integer", "minimum": 0 },
            "children": { "type": "integer", "minimum": 0 },
            "infants":  { "type": "integer", "minimum": 0 }
          },
          "required": ["adults", "children", "infants"],
          "additionalProperties": false
        },
        "currency": { "type": "string", "pattern": "^[A-Z]{3}$" },
        "cover_image_url": { "type": "string", "pattern": "^https://.+$" }
      },
      "required": ["destination", "start_date", "end_date", "travelers", "currency"],
      "additionalProperties": false
    },

    "flights": {
      "type": "object",
      "properties": {
        "has_offer": { "type": "string", "enum": ["yes", "no"] },
        "best": {
          "type": "object",
          "properties": {
            "id": { "type": "string" },
            "label": { "type": "string" },
            "currency": { "type": "string" },
            "price_total": { "type": "string" },
            "out_origin": { "type": "string" },
            "out_destination": { "type": "string" },
            "out_depart_at": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$" },
            "out_arrive_at": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$" },
            "ret_origin": { "type": "string" },
            "ret_destination": { "type": "string" },
            "ret_depart_at": { "type": "string", "pattern": "^(|\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2})$" },
            "ret_arrive_at": { "type": "string", "pattern": "^(|\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2})$" },
            "deeplink": { "type": "string", "pattern": "^https://.+$" },
            "deeplinks": {
              "type": "object",
              "properties": {
                "skyscanner": { "type": "string", "pattern": "^https://.+$" },
                "google": { "type": "string", "pattern": "^https://.+$" }
              },
              "additionalProperties": false
            }
          },
          "required": ["out_origin","out_destination","out_depart_at","out_arrive_at"],
          "additionalProperties": false
        },
        "alternatives": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": "string" },
              "label": { "type": "string" },
              "currency": { "type": "string" },
              "price_total": { "type": "string" },
              "out_origin": { "type": "string" },
              "out_destination": { "type": "string" },
              "out_depart_at": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$" },
              "out_arrive_at": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$" },
              "ret_origin": { "type": "string" },
              "ret_destination": { "type": "string" },
              "ret_depart_at": { "type": "string", "pattern": "^(|\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2})$" },
              "ret_arrive_at": { "type": "string", "pattern": "^(|\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2})$" },
              "deeplink": { "type": "string", "pattern": "^https://.+$" },

              "total_duration": { "type": "string" },
              "total_stops": { "type": "string" },
              "carriers": { "type": "string" },
              "cabins": { "type": "string" },
              "cabin_best": { "type": "string" },
              "seats_left": { "type": "string" },
              "bags_qty": { "type": "string" },
              "route_key": { "type": "string" },
              "out_month_yyyy_mm": { "type": "string" }
            },
            "required": ["id","label","currency","price_total","out_origin","out_destination","out_depart_at","out_arrive_at"],
            "additionalProperties": false
          }
        }
      },
      "required": ["best"],
      "additionalProperties": false
    },

    "hotel": {
      "type": "object",
      "properties": {
        "best": {
          "type": "object",
          "properties": {
            "id": { "type": ["integer","string"] },
            "name": { "type": "string" },
            "stars": { "type": "integer", "minimum": 1, "maximum": 5 },
            "price_total": { "type": "string" },
            "price_per_night": { "type": "string" },
            "currency": { "type": "string" },
            "location_name": { "type": "string" },
            "country": { "type": "string" },
            "lat": { "type": ["number","null"] },
            "lon": { "type": ["number","null"] },
            "deeplink": { "type": "string", "pattern": "^https://.+$" },
            "budget_band": { "type": "string" },
            "within_budget": { "type": "boolean" },
            "description": { "type": "string" }
          },
          "required": ["name","stars","currency"],
          "additionalProperties": false
        },
        "shortlist": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "stars": { "type": "integer", "minimum": 1, "maximum": 5 },
              "price_total": { "type": "string" },
              "price_per_night": { "type": "string" },
              "currency": { "type": "string" },
              "deeplink": { "type": "string", "pattern": "^https://.+$" }
            },
            "required": ["name","stars","currency"],
            "additionalProperties": false
          }
        }
      },
      "required": ["best"],
      "additionalProperties": false
    },

    "transfer": {
      "type": "object",
      "properties": {
        "best": {
          "type": "object",
          "properties": {
            "id": { "type": "string" },
            "type": { "type": "string" },
            "start_at": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$" },
            "start_location_code": { "type": "string" },
            "end_at": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$" },
            "end_city": { "type": "string" },
            "end_country": { "type": "string" },
            "vehicle": {
              "type": "object",
              "properties": {
                "code": { "type": "string" },
                "desc": { "type": "string" },
                "seats": { "type": ["integer","null"] },
                "baggages": { "type": ["integer","null"] },
                "imageURL": { "type": "string", "pattern": "^https://.+$" }
              },
              "required": ["code"],
              "additionalProperties": false
            },
            "provider": { "type": "string" },
            "price": {
              "type": "object",
              "properties": {
                "amount": { "type": "string" },
                "currency": { "type": "string" }
              },
              "additionalProperties": false
            },
            "duration_iso": { "type": "string" },
            "distance_mi": { "type": ["number","null"] },
            "deeplink": { "type": "string", "pattern": "^https://.+$" },
            "experience": { "type": "string" }
          },
          "required": ["type","end_city","end_country"],
          "additionalProperties": false
        },
        "options": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": "string" },
              "vehicle": {
                "type": "object",
                "properties": {
                  "code": { "type": "string" },
                  "seats": { "type": ["integer","null"] },
                  "baggages": { "type": ["integer","null"] }
                },
                "required": ["code"],
                "additionalProperties": false
              },
              "price": {
                "type": "object",
                "properties": {
                  "amount": { "type": "string" },
                  "currency": { "type": "string" }
                },
                "required": ["amount","currency"],
                "additionalProperties": false
              },
              "deeplink": { "type": "string", "pattern": "^https://.+$" }
            },
            "required": ["id","vehicle","price"],
            "additionalProperties": false
          }
        },
        "cover_images": {
          "type": "array",
          "items": { "type": "string", "pattern": "^https://.+$" }
        }
      },
      "required": ["best","options","cover_images"],
      "additionalProperties": false
    },

    "activities": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "name": { "type": "string" },
          "description": { "type": "string" },
          "price_amount": { "type": "string" },
          "price_currency": { "type": "string" },
          "booking_link": { "type": "string", "pattern": "^https://.+$" },
          "image_url": { "type": "string", "pattern": "^https://.+$" }
        },
        "required": ["id","name","price_amount","price_currency","booking_link","image_url"],
        "additionalProperties": false
      }
    },

    "emergency_info": {
      "type": "object",
      "properties": {
        "emergency_numbers": { "type": "array", "items": { "type": "string" }, "minItems": 1 },
        "nearest_hospital": {
          "type": "object",
          "properties": {
            "name": { "type": "string" },
            "address": { "type": "string" },
            "phone": { "type": "string" }
          },
          "required": ["name","address","phone"],
          "additionalProperties": false
        },
        "embassy_contact": {
          "type": "object",
          "properties": {
            "name": { "type": "string" },
            "address": { "type": "string" },
            "phone": { "type": "string" }
          },
          "required": ["name","address","phone"],
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },

    "pricing_hint": {
      "type": "object",
      "properties": {
        "notes": { "type": "string" },
        "currency": { "type": "string", "pattern": "^[A-Z]{3}$" }
      },
      "required": ["notes","currency"],
      "additionalProperties": false
    }
  },
  "required": ["meta","flights","hotel","transfer","activities"],
  "additionalProperties": false
}
